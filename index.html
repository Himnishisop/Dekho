<script>
const videos=[
 {src:"https://jumpshare.com/embed/Kejm8b0gKg2XLVxjTosc",time:25},
 {src:"https://jumpshare.com/embed/Hl4WY6alMoQsWl6MYZqF",time:12},
 {src:"https://jumpshare.com/embed/irQmZZ5gRWYz3HjAlTUM",time:36},
 {src:"https://jumpshare.com/embed/n7mnvhCvK0BxB3L9A9Wy",time:34},
 {src:"https://jumpshare.com/embed/JeY2q3h6lYLZGcO9lNjl",time:28,last:true}
];

const container=document.getElementById("videoContainer");
let current=null;
let timer=null;
let blockAutoStart=false; // ðŸ”’ MAIN FIX

videos.forEach((v,i)=>{
    const card=document.createElement("div");
    card.className="video-card";
    card.id="video-"+i;
    card.dataset.index=i;

    card.innerHTML=`
        <div class="video-title">à¤µà¥€à¤¡à¤¿à¤¯à¥‹ ${i+1}</div>
        <div class="timer" id="timer-${i}">
            à¤¸à¤®à¤¯ à¤¬à¤šà¤¾ à¤¹à¥ˆ: ${v.time} à¤¸à¥‡à¤•à¤‚à¤¡
        </div>

        <div class="video-wrapper">
            <iframe src="${v.src}" allowfullscreen></iframe>
        </div>
    `;
    container.appendChild(card);
});

/* OBSERVER */
const observer=new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
        if(entry.isIntersecting){
            const i=entry.target.dataset.index;

            // ðŸš« à¤…à¤—à¤²à¤¾ à¤µà¥€à¤¡à¤¿à¤¯à¥‹ button se aaye ho to ignore
            if(blockAutoStart){
                blockAutoStart=false;
                return;
            }

            startTimer(i);
        }
    });
},{threshold:0.7});

document.querySelectorAll(".video-card").forEach(card=>{
    observer.observe(card);
});

function startTimer(i){
    if(current==i) return;

    current=i;
    clearInterval(timer);

    let timeLeft=videos[i].time;
    const timerEl=document.getElementById("timer-"+i);

    timerEl.innerText=`à¤¸à¤®à¤¯ à¤¬à¤šà¤¾ à¤¹à¥ˆ: ${timeLeft} à¤¸à¥‡à¤•à¤‚à¤¡`;

    timer=setInterval(()=>{
        timeLeft--;
        timerEl.innerText=`à¤¸à¤®à¤¯ à¤¬à¤šà¤¾ à¤¹à¥ˆ: ${timeLeft} à¤¸à¥‡à¤•à¤‚à¤¡`;

        if(timeLeft<=0){
            clearInterval(timer);
            showPopup(i);
        }
    },1000);
}

function showPopup(i){
    document.getElementById("popup").style.display="flex";

    if(videos[i].last){
        popupText.innerText=
        "à¤†à¤ªà¤¨à¥‡ â‚¹2 à¤•à¤®à¤¾ à¤²à¤¿à¤ à¤¹à¥ˆà¤‚à¥¤\n\nà¤”à¤° à¤œà¤¼à¥à¤¯à¤¾à¤¦à¤¾ à¤•à¤®à¤¾à¤¨à¥‡ à¤µ à¤¨à¤¿à¤•à¤¾à¤²à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤°à¤œà¤¿à¤¸à¥à¤Ÿà¤° à¤•à¤°à¥‡à¤‚à¥¤";
        popupBtn.innerText="à¤°à¤œà¤¿à¤¸à¥à¤Ÿà¤° à¤•à¤°à¥‡à¤‚";
    }else{
        popupText.innerText="à¤†à¤ªà¤¨à¥‡ â‚¹2 à¤•à¤®à¤¾ à¤²à¤¿à¤ à¤¹à¥ˆà¤‚à¥¤ à¤…à¤—à¤²à¤¾ à¤µà¥€à¤¡à¤¿à¤¯à¥‹ à¤¦à¥‡à¤–à¥‡à¤‚à¥¤";
        popupBtn.innerText="à¤…à¤—à¤²à¤¾ à¤µà¥€à¤¡à¤¿à¤¯à¥‹";
    }
}

function closePopup(){
    document.getElementById("popup").style.display="none";

    if(!videos[current].last){
        blockAutoStart=true; // ðŸ”’ TIMER BLOCK
        scrollToVideo(parseInt(current)+1);
    }
}

function scrollToVideo(i){
    document.getElementById("video-"+i)
    .scrollIntoView({behavior:"smooth"});
}
</script>
